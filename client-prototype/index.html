<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Card Game Compiler Prototype Client</title>

    <script src="http://localhost:8020/socket.io/socket.io.js"></script>

    <!-- NOTE: This prototype client was generated by ChatGPT according to specifications -->
    <!-- NOTE: This prototype client is NOT INTENDED FOR USE IN PRODUCTION -->
    <!-- NOTE: This prototype client will not be in the final product and should not be optimized except for testing purposes -->

    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .pile {
            display: inline-block;
            vertical-align: top;
            margin: 10px;
            padding: 10px;
            border: 1px solid black;
            min-width: 120px;
            cursor: pointer;
        }

        .card {
            border: 1px solid gray;
            padding: 3px;
            margin: 2px 0;
            font-size: 12px;
        }

        .counter {
            margin: 5px 0;
        }
    </style>

    <script>
        const socket = io("http://localhost:8020");

        let currentGameState = null;

        // ---------------------------
        // Socket Events
        // ---------------------------

        socket.on("connect", () => {
            console.log("Connected with id:", socket.id);
        });

        socket.on("gamestate", (state) => {
            console.log("Received gamestate:", state);
            currentGameState = state;
            renderGameState();
        });

        // ---------------------------
        // Rendering
        // ---------------------------

        function renderGameState() {
            if (!currentGameState) return;

            const board = document.getElementById("board");
            board.innerHTML = ""; // wipe everything (prototype behavior)

            // ---- Render Board ----
            const boardSection = document.createElement("div");
            boardSection.className = "section";
            boardSection.innerHTML = "<h2>Board</h2>";

            renderPiles(currentGameState.board.piles, boardSection);
            renderCounters(currentGameState.board.counters, boardSection);

            board.appendChild(boardSection);

            // ---- Render Players ----
            currentGameState.players.forEach((player, index) => {
                const playerSection = document.createElement("div");
                playerSection.className = "section";
                playerSection.innerHTML = `<h2>Player ${index}</h2>`;

                renderPiles(player.piles, playerSection);
                renderCounters(player.counters, playerSection);

                board.appendChild(playerSection);
            });
        }

        function renderPiles(piles, parent) {
            if (!piles) return;

            piles.forEach(pile => {
                const pileDiv = document.createElement("div");
                pileDiv.className = "pile";
                pileDiv.onclick = () => elementClick(pile.label);

                const title = document.createElement("div");
                title.innerHTML = `<strong>${pile.label}</strong>`;
                pileDiv.appendChild(title);

                if (pile.visibility === 2) {
                    pileDiv.appendChild(document.createTextNode("NOT VISIBLE"));
                } else if (pile.visibility === 1) {
                    pileDiv.appendChild(document.createTextNode(`FACE DOWN (${pile.cards.length} cards)`));
                } else {
                    // FACE UP
                    pile.cards.forEach(card => {
                        const cardDiv = document.createElement("div");
                        cardDiv.className = "card";
                        cardDiv.innerText = `${card.rank} of ${card.suit}`;
                        pileDiv.appendChild(cardDiv);
                    });
                }

                parent.appendChild(pileDiv);
            });
        }

        function renderCounters(counters, parent) {
            if (!counters) return;

            counters.forEach(counter => {
                const counterDiv = document.createElement("div");
                counterDiv.className = "counter";
                counterDiv.innerText = `${counter.label}: ${counter.value}`;
                parent.appendChild(counterDiv);
            });
        }

        function elementClick(label) {
            console.log("Clicked:", label);
            socket.emit("playerClickEvent", label);
        }

        function startGame() {
            console.log("Requesting new game...");
            socket.emit("newGame");
        }
    </script>
</head>

<body>

    <h1>Card Game Prototype Client</h1>

    <button onclick="startGame()">
        Start Game
    </button>

    <hr>

    <div id="board"></div>

</body>
</html>
